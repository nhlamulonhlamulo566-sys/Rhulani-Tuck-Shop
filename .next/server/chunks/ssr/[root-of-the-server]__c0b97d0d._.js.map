{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/firebase/admin.ts"],"sourcesContent":["import { initializeApp, cert, getApps, App } from 'firebase-admin/app';\nimport { getAuth } from 'firebase-admin/auth';\nimport { getFirestore } from 'firebase-admin/firestore';\nimport fs from 'fs';\nimport path from 'path';\n\n// Define a function to initialize the admin app to avoid top-level execution\nfunction initializeAdminApp(): App {\n  if (getApps().some(app => app.name === 'admin')) {\n    return getApps().find(app => app.name === 'admin')!;\n  }\n\n  const serviceAccountString = process.env.FIREBASE_ADMIN_SDK_CONFIG;\n  let finalServiceAccountString = serviceAccountString;\n\n  // Prefer a local `firebase-adminsdk.json` file when present (safer than relying on\n  // a potentially malformed environment variable). If the file isn't present, fall\n  // back to the `FIREBASE_ADMIN_SDK_CONFIG` environment variable.\n  try {\n    const filePath = path.join(process.cwd(), 'firebase-adminsdk.json');\n    if (fs.existsSync(filePath)) {\n      finalServiceAccountString = fs.readFileSync(filePath, 'utf8');\n    }\n  } catch (err) {\n    // ignore and let the later check throw a helpful error\n  }\n\n  if (!finalServiceAccountString) {\n    throw new Error('The FIREBASE_ADMIN_SDK_CONFIG environment variable is not set and no firebase-adminsdk.json file was found. This is required for server-side Firebase operations.');\n  }\n\n  try {\n    // Sanitize the JSON string: trim, remove BOM, and strip markdown code fences if present.\n    let jsonStr = finalServiceAccountString!.toString().trim();\n\n    // Remove UTF-8 BOM if present\n    if (jsonStr.charCodeAt(0) === 0xfeff) {\n      jsonStr = jsonStr.slice(1);\n    }\n\n    // Strip fenced code blocks (e.g., ```json ... ```)\n    if (jsonStr.startsWith('```')) {\n      const firstNewline = jsonStr.indexOf('\\n');\n      if (firstNewline !== -1) {\n        jsonStr = jsonStr.slice(firstNewline + 1);\n        // remove trailing fence if present\n        const trailingFence = jsonStr.lastIndexOf('\\n```');\n        if (trailingFence !== -1) {\n          jsonStr = jsonStr.slice(0, trailingFence);\n        }\n      }\n    }\n\n    jsonStr = jsonStr.trim();\n\n    // Helper to parse either a JSON object string or a double-encoded JSON string.\n    const tryParseServiceAccount = (s: string) => {\n      let out: any = JSON.parse(s);\n      if (typeof out === 'string') out = JSON.parse(out);\n      return out;\n    };\n\n    // First, try to parse the current string (likely from env var).\n    let serviceAccount: any;\n    try {\n      serviceAccount = tryParseServiceAccount(jsonStr);\n    } catch (firstErr) {\n      // If parsing the env var failed, attempt to read a local `firebase-adminsdk.json` file\n      // as a fallback (common when .env was used incorrectly).\n      try {\n        const filePath = path.join(process.cwd(), 'firebase-adminsdk.json');\n        if (fs.existsSync(filePath)) {\n          const fileContent = fs.readFileSync(filePath, 'utf8').toString().trim();\n          serviceAccount = tryParseServiceAccount(fileContent);\n          console.warn('Falling back to firebase-adminsdk.json file for Firebase Admin credentials.');\n        } else {\n          throw firstErr;\n        }\n      } catch (secondErr) {\n        // Re-throw the original parsing error to preserve the most relevant message.\n        throw firstErr;\n      }\n    }\n\n    return initializeApp({\n      credential: cert(serviceAccount),\n      databaseURL: `https://${serviceAccount.project_id}.firebaseio.com`,\n    }, 'admin');\n  } catch (error: any) {\n    console.error('Error parsing Firebase Admin SDK config or initializing app:', error);\n    throw new Error(`Failed to initialize Firebase Admin SDK. Check FIREBASE_ADMIN_SDK_CONFIG or firebase-adminsdk.json: ${error?.message || error}`);\n  }\n}\n\n// Get the initialized app\nconst adminApp = initializeAdminApp();\n\n// Export auth and firestore instances from the named 'admin' app\nexport const adminAuth = getAuth(adminApp);\nexport const adminDb = getFirestore(adminApp);\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAEA,6EAA6E;AAC7E,SAAS;IACP,IAAI,IAAA,2JAAO,IAAG,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI,KAAK,UAAU;QAC/C,OAAO,IAAA,2JAAO,IAAG,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI,KAAK;IAC5C;IAEA,MAAM,uBAAuB,QAAQ,GAAG,CAAC,yBAAyB;IAClE,IAAI,4BAA4B;IAEhC,mFAAmF;IACnF,iFAAiF;IACjF,gEAAgE;IAChE,IAAI;QACF,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAC1C,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;YAC3B,4BAA4B,wGAAE,CAAC,YAAY,CAAC,UAAU;QACxD;IACF,EAAE,OAAO,KAAK;IACZ,uDAAuD;IACzD;IAEA,IAAI,CAAC,2BAA2B;QAC9B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,yFAAyF;QACzF,IAAI,UAAU,0BAA2B,QAAQ,GAAG,IAAI;QAExD,8BAA8B;QAC9B,IAAI,QAAQ,UAAU,CAAC,OAAO,QAAQ;YACpC,UAAU,QAAQ,KAAK,CAAC;QAC1B;QAEA,mDAAmD;QACnD,IAAI,QAAQ,UAAU,CAAC,QAAQ;YAC7B,MAAM,eAAe,QAAQ,OAAO,CAAC;YACrC,IAAI,iBAAiB,CAAC,GAAG;gBACvB,UAAU,QAAQ,KAAK,CAAC,eAAe;gBACvC,mCAAmC;gBACnC,MAAM,gBAAgB,QAAQ,WAAW,CAAC;gBAC1C,IAAI,kBAAkB,CAAC,GAAG;oBACxB,UAAU,QAAQ,KAAK,CAAC,GAAG;gBAC7B;YACF;QACF;QAEA,UAAU,QAAQ,IAAI;QAEtB,+EAA+E;QAC/E,MAAM,yBAAyB,CAAC;YAC9B,IAAI,MAAW,KAAK,KAAK,CAAC;YAC1B,IAAI,OAAO,QAAQ,UAAU,MAAM,KAAK,KAAK,CAAC;YAC9C,OAAO;QACT;QAEA,gEAAgE;QAChE,IAAI;QACJ,IAAI;YACF,iBAAiB,uBAAuB;QAC1C,EAAE,OAAO,UAAU;YACjB,uFAAuF;YACvF,yDAAyD;YACzD,IAAI;gBACF,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;gBAC1C,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;oBAC3B,MAAM,cAAc,wGAAE,CAAC,YAAY,CAAC,UAAU,QAAQ,QAAQ,GAAG,IAAI;oBACrE,iBAAiB,uBAAuB;oBACxC,QAAQ,IAAI,CAAC;gBACf,OAAO;oBACL,MAAM;gBACR;YACF,EAAE,OAAO,WAAW;gBAClB,6EAA6E;gBAC7E,MAAM;YACR;QACF;QAEA,OAAO,IAAA,iKAAa,EAAC;YACnB,YAAY,IAAA,wJAAI,EAAC;YACjB,aAAa,CAAC,QAAQ,EAAE,eAAe,UAAU,CAAC,eAAe,CAAC;QACpE,GAAG;IACL,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gEAAgE;QAC9E,MAAM,IAAI,MAAM,CAAC,oGAAoG,EAAE,OAAO,WAAW,OAAO;IAClJ;AACF;AAEA,0BAA0B;AAC1B,MAAM,WAAW;AAGV,MAAM,YAAY,IAAA,6JAAO,EAAC;AAC1B,MAAM,UAAU,IAAA,4KAAY,EAAC","debugId":null}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/app/%28dashboard%29/returns/actions.ts"],"sourcesContent":["'use server';\n\nimport { adminDb } from '@/firebase/admin';\nimport { firestore } from 'firebase-admin';\nimport type { Sale } from '@/lib/types';\n\nexport async function voidTransactionAction(\n  saleId: string\n): Promise<{ success: boolean; error: string | null }> {\n  if (!saleId) {\n    return { success: false, error: 'Sale ID is required.' };\n  }\n\n  try {\n    const saleRef = adminDb.collection('sales').doc(saleId);\n\n    await adminDb.runTransaction(async (transaction) => {\n      const saleDoc = await transaction.get(saleRef);\n      if (!saleDoc.exists) {\n        throw new Error('Sale not found.');\n      }\n\n      const saleData = saleDoc.data() as Sale;\n\n      if (saleData.status === 'voided') {\n        throw new Error('This sale has already been voided.');\n      }\n\n      // Restore stock for each item in the sale that has not been returned yet\n      for (const item of saleData.items) {\n        const productRef = adminDb.collection('products').doc(item.productId);\n        const stockToRestore = item.quantity - (item.returnedQuantity || 0);\n        if (stockToRestore > 0) {\n            transaction.update(productRef, {\n                stock: firestore.FieldValue.increment(stockToRestore),\n            });\n        }\n      }\n\n      // Mark the sale as voided\n      transaction.update(saleRef, { status: 'voided' });\n    });\n\n    return { success: true, error: null };\n  } catch (error: any) {\n    console.error('Error voiding transaction:', error);\n    return { success: false, error: error.message || 'An unexpected error occurred.' };\n  }\n}\n\nexport async function returnItemsAction(\n    saleId: string,\n    itemsToReturn: { productId: string; quantity: number }[]\n): Promise<{ success: boolean; error: string | null }> {\n    if (!saleId || !itemsToReturn || itemsToReturn.length === 0) {\n        return { success: false, error: 'Invalid input for returning items.' };\n    }\n    \n    try {\n        const saleRef = adminDb.collection('sales').doc(saleId);\n\n        await adminDb.runTransaction(async (transaction) => {\n            const saleDoc = await transaction.get(saleRef);\n            if (!saleDoc.exists) {\n                throw new Error('Sale not found.');\n            }\n\n            const saleData = saleDoc.data() as Sale;\n            \n            if (saleData.status === 'voided') {\n                throw new Error('Cannot return items from a voided sale.');\n            }\n\n            const newItems = [...saleData.items];\n            let allItemsReturned = true;\n\n            for (const itemToReturn of itemsToReturn) {\n                const itemIndex = newItems.findIndex(i => i.productId === itemToReturn.productId);\n                if (itemIndex === -1) {\n                    throw new Error(`Product ${itemToReturn.productId} not found in this sale.`);\n                }\n                \n                const originalItem = newItems[itemIndex];\n                const currentReturnedQty = originalItem.returnedQuantity || 0;\n                const newReturnedQty = currentReturnedQty + itemToReturn.quantity;\n                \n                if (newReturnedQty > originalItem.quantity) {\n                    throw new Error(`Cannot return more ${originalItem.productName} than were purchased.`);\n                }\n                \n                newItems[itemIndex] = { ...originalItem, returnedQuantity: newReturnedQty };\n                \n                // Restore stock\n                const productRef = adminDb.collection('products').doc(itemToReturn.productId);\n                transaction.update(productRef, {\n                    stock: firestore.FieldValue.increment(itemToReturn.quantity),\n                });\n            }\n\n            // Check if all items are now fully returned\n            for(const item of newItems) {\n                if ((item.returnedQuantity || 0) < item.quantity) {\n                    allItemsReturned = false;\n                    break;\n                }\n            }\n            \n            const newStatus = allItemsReturned ? 'voided' : 'partially-returned';\n\n            transaction.update(saleRef, { items: newItems, status: newStatus });\n        });\n        \n        return { success: true, error: null };\n    } catch (error: any) {\n        console.error('Error processing return:', error);\n        return { success: false, error: error.message || 'An unexpected error occurred.' };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 302, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/.next-internal/server/app/%28dashboard%29/returns/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {voidTransactionAction as '40785e84d2ab057ca05b8dc2d1654fe52ab61e20ac'} from 'ACTIONS_MODULE0'\nexport {returnItemsAction as '6070ec9c935f6a973084fe1c21ab425d9b76cf32b2'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/app/%28dashboard%29/returns/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(dashboard)/returns/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/returns/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAwS,GACrU,sEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 361, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/app/%28dashboard%29/returns/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(dashboard)/returns/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/returns/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAoR,GACjT,kDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}