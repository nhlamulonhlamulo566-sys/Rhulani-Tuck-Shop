{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/firebase/admin.ts"],"sourcesContent":["import { initializeApp, cert, getApps, App } from 'firebase-admin/app';\nimport { getAuth } from 'firebase-admin/auth';\nimport { getFirestore } from 'firebase-admin/firestore';\nimport fs from 'fs';\nimport path from 'path';\n\n// Define a function to initialize the admin app to avoid top-level execution\nfunction initializeAdminApp(): App {\n  if (getApps().some(app => app.name === 'admin')) {\n    return getApps().find(app => app.name === 'admin')!;\n  }\n\n  const serviceAccountString = process.env.FIREBASE_ADMIN_SDK_CONFIG;\n  let finalServiceAccountString = serviceAccountString;\n\n  // Prefer a local `firebase-adminsdk.json` file when present (safer than relying on\n  // a potentially malformed environment variable). If the file isn't present, fall\n  // back to the `FIREBASE_ADMIN_SDK_CONFIG` environment variable.\n  try {\n    const filePath = path.join(process.cwd(), 'firebase-adminsdk.json');\n    if (fs.existsSync(filePath)) {\n      finalServiceAccountString = fs.readFileSync(filePath, 'utf8');\n    }\n  } catch (err) {\n    // ignore and let the later check throw a helpful error\n  }\n\n  if (!finalServiceAccountString) {\n    throw new Error('The FIREBASE_ADMIN_SDK_CONFIG environment variable is not set and no firebase-adminsdk.json file was found. This is required for server-side Firebase operations.');\n  }\n\n  try {\n    // Sanitize the JSON string: trim, remove BOM, and strip markdown code fences if present.\n    let jsonStr = finalServiceAccountString!.toString().trim();\n\n    // Remove UTF-8 BOM if present\n    if (jsonStr.charCodeAt(0) === 0xfeff) {\n      jsonStr = jsonStr.slice(1);\n    }\n\n    // Strip fenced code blocks (e.g., ```json ... ```)\n    if (jsonStr.startsWith('```')) {\n      const firstNewline = jsonStr.indexOf('\\n');\n      if (firstNewline !== -1) {\n        jsonStr = jsonStr.slice(firstNewline + 1);\n        // remove trailing fence if present\n        const trailingFence = jsonStr.lastIndexOf('\\n```');\n        if (trailingFence !== -1) {\n          jsonStr = jsonStr.slice(0, trailingFence);\n        }\n      }\n    }\n\n    jsonStr = jsonStr.trim();\n\n    // Helper to parse either a JSON object string or a double-encoded JSON string.\n    const tryParseServiceAccount = (s: string) => {\n      let out: any = JSON.parse(s);\n      if (typeof out === 'string') out = JSON.parse(out);\n      return out;\n    };\n\n    // First, try to parse the current string (likely from env var).\n    let serviceAccount: any;\n    try {\n      serviceAccount = tryParseServiceAccount(jsonStr);\n    } catch (firstErr) {\n      // If parsing the env var failed, attempt to read a local `firebase-adminsdk.json` file\n      // as a fallback (common when .env was used incorrectly).\n      try {\n        const filePath = path.join(process.cwd(), 'firebase-adminsdk.json');\n        if (fs.existsSync(filePath)) {\n          const fileContent = fs.readFileSync(filePath, 'utf8').toString().trim();\n          serviceAccount = tryParseServiceAccount(fileContent);\n          console.warn('Falling back to firebase-adminsdk.json file for Firebase Admin credentials.');\n        } else {\n          throw firstErr;\n        }\n      } catch (secondErr) {\n        // Re-throw the original parsing error to preserve the most relevant message.\n        throw firstErr;\n      }\n    }\n\n    return initializeApp({\n      credential: cert(serviceAccount),\n      databaseURL: `https://${serviceAccount.project_id}.firebaseio.com`,\n    }, 'admin');\n  } catch (error: any) {\n    console.error('Error parsing Firebase Admin SDK config or initializing app:', error);\n    throw new Error(`Failed to initialize Firebase Admin SDK. Check FIREBASE_ADMIN_SDK_CONFIG or firebase-adminsdk.json: ${error?.message || error}`);\n  }\n}\n\n// Get the initialized app\nconst adminApp = initializeAdminApp();\n\n// Export auth and firestore instances from the named 'admin' app\nexport const adminAuth = getAuth(adminApp);\nexport const adminDb = getFirestore(adminApp);\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAEA,6EAA6E;AAC7E,SAAS;IACP,IAAI,IAAA,2JAAO,IAAG,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI,KAAK,UAAU;QAC/C,OAAO,IAAA,2JAAO,IAAG,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI,KAAK;IAC5C;IAEA,MAAM,uBAAuB,QAAQ,GAAG,CAAC,yBAAyB;IAClE,IAAI,4BAA4B;IAEhC,mFAAmF;IACnF,iFAAiF;IACjF,gEAAgE;IAChE,IAAI;QACF,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAC1C,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;YAC3B,4BAA4B,wGAAE,CAAC,YAAY,CAAC,UAAU;QACxD;IACF,EAAE,OAAO,KAAK;IACZ,uDAAuD;IACzD;IAEA,IAAI,CAAC,2BAA2B;QAC9B,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,yFAAyF;QACzF,IAAI,UAAU,0BAA2B,QAAQ,GAAG,IAAI;QAExD,8BAA8B;QAC9B,IAAI,QAAQ,UAAU,CAAC,OAAO,QAAQ;YACpC,UAAU,QAAQ,KAAK,CAAC;QAC1B;QAEA,mDAAmD;QACnD,IAAI,QAAQ,UAAU,CAAC,QAAQ;YAC7B,MAAM,eAAe,QAAQ,OAAO,CAAC;YACrC,IAAI,iBAAiB,CAAC,GAAG;gBACvB,UAAU,QAAQ,KAAK,CAAC,eAAe;gBACvC,mCAAmC;gBACnC,MAAM,gBAAgB,QAAQ,WAAW,CAAC;gBAC1C,IAAI,kBAAkB,CAAC,GAAG;oBACxB,UAAU,QAAQ,KAAK,CAAC,GAAG;gBAC7B;YACF;QACF;QAEA,UAAU,QAAQ,IAAI;QAEtB,+EAA+E;QAC/E,MAAM,yBAAyB,CAAC;YAC9B,IAAI,MAAW,KAAK,KAAK,CAAC;YAC1B,IAAI,OAAO,QAAQ,UAAU,MAAM,KAAK,KAAK,CAAC;YAC9C,OAAO;QACT;QAEA,gEAAgE;QAChE,IAAI;QACJ,IAAI;YACF,iBAAiB,uBAAuB;QAC1C,EAAE,OAAO,UAAU;YACjB,uFAAuF;YACvF,yDAAyD;YACzD,IAAI;gBACF,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;gBAC1C,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;oBAC3B,MAAM,cAAc,wGAAE,CAAC,YAAY,CAAC,UAAU,QAAQ,QAAQ,GAAG,IAAI;oBACrE,iBAAiB,uBAAuB;oBACxC,QAAQ,IAAI,CAAC;gBACf,OAAO;oBACL,MAAM;gBACR;YACF,EAAE,OAAO,WAAW;gBAClB,6EAA6E;gBAC7E,MAAM;YACR;QACF;QAEA,OAAO,IAAA,iKAAa,EAAC;YACnB,YAAY,IAAA,wJAAI,EAAC;YACjB,aAAa,CAAC,QAAQ,EAAE,eAAe,UAAU,CAAC,eAAe,CAAC;QACpE,GAAG;IACL,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gEAAgE;QAC9E,MAAM,IAAI,MAAM,CAAC,oGAAoG,EAAE,OAAO,WAAW,OAAO;IAClJ;AACF;AAEA,0BAA0B;AAC1B,MAAM,WAAW;AAGV,MAAM,YAAY,IAAA,6JAAO,EAAC;AAC1B,MAAM,UAAU,IAAA,4KAAY,EAAC","debugId":null}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/app/%28dashboard%29/settings/actions.ts"],"sourcesContent":["'use server';\n\nimport { adminAuth, adminDb } from '@/firebase/admin';\nimport type { UserProfile } from '@/lib/types';\n\ninterface CreateUserActionInput {\n    email: string;\n    password?: string;\n    displayName: string;\n    role: 'administration' | 'sales';\n}\n\nexport async function createUserAction(\n  input: CreateUserActionInput\n): Promise<{ uid: string | null; error: string | null }> {\n  try {\n    // Create user in Firebase Auth\n    const userRecord = await adminAuth.createUser({\n      email: input.email,\n      password: input.password,\n      displayName: input.displayName,\n      emailVerified: true, // Or based on your flow\n    });\n\n    // Create user profile in Firestore\n    const userRef = adminDb.collection('users').doc(userRecord.uid);\n    \n    const newUserProfile: UserProfile = {\n      id: userRecord.uid,\n      name: input.displayName,\n      email: input.email,\n      avatarUrl: '', // You can add a default avatar URL here\n      role: input.role,\n    };\n\n    await userRef.set(newUserProfile);\n\n    // Optionally set custom claims for roles\n    await adminAuth.setCustomUserClaims(userRecord.uid, { role: input.role });\n\n    return { uid: userRecord.uid, error: null };\n  } catch (error: any) {\n    console.error('Error creating user:', error);\n    // Return a more specific error message if available\n    return { uid: null, error: error.message || 'An unexpected error occurred.' };\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;;;;;AAUO,eAAe,iBACpB,KAA4B;IAE5B,IAAI;QACF,+BAA+B;QAC/B,MAAM,aAAa,MAAM,qIAAS,CAAC,UAAU,CAAC;YAC5C,OAAO,MAAM,KAAK;YAClB,UAAU,MAAM,QAAQ;YACxB,aAAa,MAAM,WAAW;YAC9B,eAAe;QACjB;QAEA,mCAAmC;QACnC,MAAM,UAAU,mIAAO,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC,WAAW,GAAG;QAE9D,MAAM,iBAA8B;YAClC,IAAI,WAAW,GAAG;YAClB,MAAM,MAAM,WAAW;YACvB,OAAO,MAAM,KAAK;YAClB,WAAW;YACX,MAAM,MAAM,IAAI;QAClB;QAEA,MAAM,QAAQ,GAAG,CAAC;QAElB,yCAAyC;QACzC,MAAM,qIAAS,CAAC,mBAAmB,CAAC,WAAW,GAAG,EAAE;YAAE,MAAM,MAAM,IAAI;QAAC;QAEvE,OAAO;YAAE,KAAK,WAAW,GAAG;YAAE,OAAO;QAAK;IAC5C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,oDAAoD;QACpD,OAAO;YAAE,KAAK;YAAM,OAAO,MAAM,OAAO,IAAI;QAAgC;IAC9E;AACF;;;IAlCsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/.next-internal/server/app/%28dashboard%29/settings/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createUserAction as '408877ebc41d07337c80f372fc4b0c4eb27ce950e2'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/app/%28dashboard%29/settings/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(dashboard)/settings/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/settings/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAyS,GACtU,uEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 269, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Health/Desktop/Rhulani%20Tuck%20Shop/src/app/%28dashboard%29/settings/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(dashboard)/settings/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/settings/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAqR,GAClT,mDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}