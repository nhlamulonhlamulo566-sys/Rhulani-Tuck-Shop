{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the ClarityCraft application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user, used for authorization.",
          "enum": [
            "Administration",
            "Sales",
            "Super Administration"
          ]
        },
        "pin": {
          "type": "string",
          "description": "A unique 6-digit PIN for administrators to authorize sensitive actions.",
          "pattern": "^[0-9]{6}$"
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the user profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role",
        "createdAt"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the ClarityCraft application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "The price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "stockLevel": {
          "type": "number",
          "description": "The current stock level of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "stockLevel",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a product category in the ClarityCraft application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the category."
        },
        "description": {
          "type": "string",
          "description": "A description of the product category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale transaction in the ClarityCraft application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Sale entity."
        },
        "saleDate": {
          "type": "string",
          "description": "The date and time of the sale.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the sale."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Sale)"
        },
        "authorizations": {
          "type": "array",
          "description": "A log of special authorizations for this sale, like voids or returns.",
          "items": {
            "type": "object",
            "properties": {
              "userId": { "type": "string" },
              "userName": { "type": "string" },
              "timestamp": { "type": "string", "format": "date-time" },
              "action": { "type": "string", "enum": ["void", "return"] },
              "details": { "type": "string" }
            },
            "required": ["userId", "userName", "timestamp", "action", "details"]
          }
        }
      },
      "required": [
        "id",
        "saleDate",
        "totalAmount",
        "userId"
      ]
    },
    "SaleItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SaleItem",
      "type": "object",
      "description": "Represents an item within a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SaleItem entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to Sale. (Relationship: Sale 1:N SaleItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N SaleItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the product sold in this sale item."
        },
        "unitPrice": {
          "type": "number",
          "description": "The price of a single unit of the product at the time of the sale."
        }
      },
      "required": [
        "id",
        "saleId",
        "productId",
        "quantity",
        "unitPrice"
      ]
    },
    "TillSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TillSession",
      "type": "object",
      "description": "Represents a daily cash till session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TillSession entity."
        },
        "startDate": {
          "type": "string",
          "description": "The date and time when the session was started.",
          "format": "date-time"
        },
        "openingBalance": {
          "type": "number",
          "description": "The starting cash float in the till."
        },
        "endDate": {
          "type": "string",
          "description": "The date and time when the session was closed.",
          "format": "date-time"
        },
        "expectedCash": {
          "type": "number",
          "description": "The expected amount of cash in the till (opening balance + cash sales)."
        },
        "countedCash": {
          "type": "number",
          "description": "The actual amount of cash counted at the end of the session."
        },
        "difference": {
          "type": "number",
          "description": "The difference between expected and counted cash."
        },
        "status": {
          "type": "string",
          "description": "The status of the till session.",
          "enum": [
            "Active",
            "Closed"
          ]
        },
        "userId": {
          "type": "string",
          "description": "The ID of the admin user who managed the session."
        },
        "userName": {
          "type": "string",
          "description": "The name of the admin user who managed the session."
        }
      },
      "required": [
        "id",
        "startDate",
        "openingBalance",
        "status",
        "userId",
        "userName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership for simple security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  This is the same as the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.  Root-level collection for global access.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. Root-level collection for global access.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sales data for each user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (owner of the sale)."
            },
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sales/{saleId}/saleItems/{saleItemId}",
        "definition": {
          "entityName": "SaleItem",
          "schema": {
            "$ref": "#/backend/entities/SaleItem"
          },
          "description": "Stores sale items for each sale. Includes denormalized 'userId' from the parent 'Sale' document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (owner of the sale)."
            },
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            },
            {
              "name": "saleItemId",
              "description": "The unique identifier for the sale item."
            }
          ]
        }
      },
      {
        "path": "/tillSessions/{sessionId}",
        "definition": {
          "entityName": "TillSession",
          "schema": {
            "$ref": "#/backend/entities/TillSession"
          },
          "description": "Stores daily till management sessions. Root-level collection for admin access.",
          "params": [
            {
              "name": "sessionId",
              "description": "The unique identifier for the till session."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, support QAPs (queries are not filters), and maintain data clarity. User profiles are stored under `/users/{userId}` to establish clear ownership. Products and Categories are stored in root-level collections for global access and simplified querying. Sales data is stored under each user's document to maintain ownership. SaleItems are nested under the Sales, with denormalized `userId` from the `Sale` document, promoting authorization independence. This design avoids using `get()` calls in security rules by denormalizing ownership and membership data where needed.\n\nThis structure enables secure list operations by ensuring that each collection contains documents with a homogeneous security posture.  For example, only the user can access their own profile and sales.  Global collections like Products and Categories can have rules that allow read access to all authenticated users, or even public read access if desired.  Denormalization of the `userId` field in `saleItems` allows security rules to validate that only the owner of the sale can modify its items, without needing to perform expensive `get()` operations."
  }
}